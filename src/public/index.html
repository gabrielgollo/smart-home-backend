<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Um teste muito louco</title>
    <link rel="stylesheet" href="style.css">
</head>

<script>
    function doRequest(data) {
        console.log(data)
        fetch("http://localhost:3330/mqtt", {
            referrerPolicy: "strict-origin-when-cross-origin",
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            method: "POST",
            body: JSON.stringify(data),
        }).then(
            res=>console.log(res.json())
        );
    }
    
    function main() {
        const topicField = document.querySelector('#topic');
        const messageField = document.querySelector('#message');

        const message = messageField.value || "Hello World!";
        const topic = topicField.value || 'teste';

        doRequest({
            topic,
            message
        })
    }

    function callServo() {
        const topic = "D4";
        const messageField = document.querySelector('#servo');

        const message = messageField.value;

        doRequest({
            topic,
            message
        })
    }

    window.onkeydown=doRequest
</script>
<body>
    <section id="main-section">
        <label>Topico:</label>
        <input id="topic" type="text" placeholder="Digite o tÃ³pico" value="defaultTopic">
        <label>Mensagem:</label>
        <input id="message" type="text" placeholder="Digite a mensagem" value="Ola mundo">
        <label>Angulo Servo:</label>
        <input type="range" min="0" max="180" value="50" class="slider" id="servo" onchange="">
        <button id="btn" onclick="main()">Enviar</button>
    </section>

    <section>
        <canvas id="main-canvas"></canvas>
    </section>
</body>
</html>